# Техническая документация проекта DocMentor

## Обзор архитектуры системы

DocMentor построен на основе гибридной edge/cloud архитектуры, которая обеспечивает высокую производительность, низкую задержку и возможность автономной работы, одновременно предоставляя доступ к расширенной базе знаний через центральный облачный сервер.

### Схема архитектуры

```
                                     ┌───────────────────────┐
                                     │                       │
                                     │   Облачный сервер     │
                                     │                       │
                                     │ - Центральное хранилище │
                                     │ - Управление обновлениями │
                                     │ - Резервное копирование │
                                     │ - Аналитика            │
                                     │                       │
                                     └───────────┬───────────┘
                                                 │
                                                 │
                                                 ▼
                   ┌───────────────────────────────────────────────┐
                   │                                               │
                   │               Защищенный канал                │
                   │                                               │
                   └───────────────────────────────────────────────┘
                     ▲                 ▲                 ▲
                     │                 │                 │
     ┌───────────────┴──┐    ┌────────┴───────┐    ┌────┴───────────┐
     │                  │    │                │    │                │
     │  Edge-узел #1    │    │  Edge-узел #2  │    │  Edge-узел #N  │
     │  (Вуз #1)        │    │  (Вуз #2)      │    │  (Вуз #N)      │
     │                  │    │                │    │                │
     │ - Локальное      │    │ - Локальное    │    │ - Локальное    │
     │   хранилище      │    │   хранилище    │    │   хранилище    │
     │ - Кэширование    │    │ - Кэширование  │    │ - Кэширование  │
     │ - Локальная      │    │ - Локальная    │    │ - Локальная    │
     │   обработка      │    │   обработка    │    │   обработка    │
     │                  │    │                │    │                │
     └──────────────────┘    └────────────────┘    └────────────────┘
              │                      │                      │
              ▼                      ▼                      ▼
     ┌──────────────────┐    ┌──────────────────┐   ┌──────────────────┐
     │                  │    │                  │   │                  │
     │  Пользователи    │    │  Пользователи    │   │  Пользователи    │
     │  Вуза #1         │    │  Вуза #2         │   │  Вуза #N         │
     │                  │    │                  │   │                  │
     └──────────────────┘    └──────────────────┘   └──────────────────┘
```

## Ключевые компоненты системы

### 1. Edge-узлы (Локальные серверы в вузах)

Edge-узлы представляют собой серверы, развернутые непосредственно в учебных заведениях, обеспечивающие высокую скорость доступа и автономность работы.

**Состав edge-узла:**
- **Локальная база знаний**: Хранение учебных материалов, специфичных для вуза
- **Кэш-система**: Кэширование часто запрашиваемых данных
- **TREAD-оптимизированная AI-модель**: Локальная обработка запросов с низкой задержкой
- **Система синхронизации**: Обмен данными с облачным сервером
- **Механизм офлайн-работы**: Функционирование при отсутствии интернета

**Технические характеристики edge-узла:**
- **Минимальные требования**: 
  - CPU: 4 ядра (Intel Core i5/AMD Ryzen 5 или выше)
  - RAM: 16 GB
  - Хранилище: 500 GB SSD
  - ОС: Ubuntu Server 22.04 LTS
- **Рекомендуемые требования**:
  - CPU: 8+ ядер (Intel Core i7/AMD Ryzen 7 или выше)
  - RAM: 32+ GB
  - Хранилище: 1+ TB SSD
  - ОС: Ubuntu Server 22.04 LTS
  - Опционально: GPU с 8+ GB VRAM для ускорения AI-вычислений

### 2. Облачный сервер

Центральный облачный сервер отвечает за координацию работы всех edge-узлов, хранение общей базы знаний и обеспечение централизованного управления.

**Основные функции:**
- **Централизованное хранилище**: Полная база учебных материалов
- **Система управления обновлениями**: Распространение обновлений на edge-узлы
- **Система резервного копирования**: Регулярное сохранение данных со всех узлов
- **Аналитическая платформа**: Сбор и анализ данных об использовании системы
- **API для интеграции**: Интерфейсы для подключения внешних систем

**Технические характеристики облачного сервера:**
- **Compute**:
  - 16+ vCPU
  - 64+ GB RAM
  - Поддержка GPU-ускорения (NVIDIA A100 или аналоги)
- **Хранилище**:
  - Основное: 10+ TB SSD
  - Архивное: 50+ TB HDD
- **Сеть**:
  - Выделенный канал 1+ Gbps
  - Поддержка SSL/TLS для защищенных соединений
  - Защита от DDoS-атак

### 3. AI-ядро системы

В основе системы лежит специализированная языковая модель Qwen2.5-MED-3B, оптимизированная для медицинской области.

**Ключевые технологии:**
- **TREAD оптимизация**: Технология маршрутизации токенов, повышающая производительность в 25 раз
- **Векторная база данных**: Эффективное хранение и быстрый поиск по медицинским текстам
- **Медицинская специализация**: Встроенная база медицинских терминов и знаний

**Принцип работы TREAD оптимизации:**

TREAD (Token Routing for Efficient Architecture-agnostic Diffusion) реализует следующие механизмы:
- **Умная маршрутизация токенов**: Динамическое распределение вычислительных ресурсов на основе важности токенов
- **Приоритизация медицинских терминов**: Повышенные веса для профессиональной медицинской лексики
- **Адаптивные пороги важности**: Автоматическая настройка под доступные вычислительные ресурсы

### 4. Модуль виртуальных пациентов

Модуль виртуальных пациентов представляет собой систему для создания и взаимодействия с виртуальными клиническими случаями.

**Составляющие модуля:**
- **Генератор клинических случаев**: Создание разнообразных клинических сценариев
- **Система моделирования пациентов**: Имитация различных патологий и их проявлений
- **Диагностический движок**: Оценка действий студента и обратная связь
- **Банк клинических случаев**: Библиотека готовых сценариев разной сложности

**Структура виртуального пациента:**
- Демографические данные (возраст, пол и т.д.)
- Жизненные показатели (пульс, давление, температура)
- Симптомы и их характеристики
- История болезни
- Результаты обследований и анализов
- Визуальные данные (МРТ, КТ, рентген и т.д.)

### 5. Система геймификации

Система геймификации интегрирована в образовательный процесс для повышения мотивации и вовлеченности студентов.

**Основные элементы:**
- **Достижения и награды**: Система бейджей за освоенные навыки и знания
- **Рейтинги и лидерборды**: Соревновательные элементы для повышения мотивации
- **Клинические челленджи**: Регулярные испытания с нарастающей сложностью
- **Система опыта и уровней**: Прогрессия навыков в различных областях медицины

### 6. Система синхронизации данных

Обеспечивает надежный обмен данными между edge-узлами и облачным сервером.

**Режимы работы:**
- **Режим полной синхронизации**: Регулярное обновление всех данных
- **Режим ограниченной синхронизации**: Обмен только критическими данными
- **Автономный режим**: Работа без подключения к облаку с локальной базой

**Технические аспекты:**
- End-to-end шифрование (TLS 1.3)
- Дельта-обновления для экономии трафика
- Приоритизация данных при ограниченном канале

## Технические требования и спецификации

### 1. Производительность

| Параметр | Требование |
|----------|------------|
| Время отклика на запрос | < 1 секунда (локальная обработка) |
| Пропускная способность | 100+ одновременных пользователей на edge-узел |
| Задержка синхронизации | < 5 минут при стандартном подключении |
| Время загрузки системы | < 10 секунд |

### 2. Надежность и доступность

| Параметр | Требование |
|----------|------------|
| Доступность системы | 99.9% времени (в автономном режиме) |
| Сохранность данных | 100% (с резервным копированием) |
| Восстановление после сбоя | < 10 минут |
| Автономная работа | До 30 дней без подключения к облаку |

### 3. Безопасность

| Параметр | Требование |
|----------|------------|
| Шифрование данных | AES-256 для данных в покое |
| Шифрование передачи | TLS 1.3 |
| Аутентификация | Многофакторная |
| Авторизация | На основе ролей (RBAC) |
| Аудит | Полное логирование всех действий |

### 4. Масштабируемость

| Параметр | Требование |
|----------|------------|
| Горизонтальное масштабирование | До 500 edge-узлов |
| Вертикальное масштабирование | До 1000 пользователей на узел |
| Объем хранимых данных | 10+ TB на облачном сервере |
| Расширение функциональности | Модульная архитектура с плагинами |

## Технический стек

### Backend:
- **Языки программирования**: Python 3.10+
- **Фреймворки**: FastAPI, PyTorch
- **Базы данных**: PostgreSQL, FAISS (векторная БД)
- **Кэширование**: Redis
- **Асинхронность**: asyncio, aiohttp

### Frontend:
- **Web-интерфейс**: React + TypeScript
- **Мобильные приложения**: Flutter
- **Десктоп-клиент**: Electron

### DevOps:
- **Контейнеризация**: Docker
- **Оркестрация**: Kubernetes
- **CI/CD**: GitLab CI
- **Мониторинг**: Prometheus + Grafana

### AI/ML:
- **Модели**: Qwen2.5-MED-3B, специализированные для медицины
- **Оптимизация**: TREAD (собственная технология)
- **Обработка данных**: PyTorch, NumPy, Pandas

## API и интеграция

DocMentor предоставляет следующие API для интеграции:

1. **REST API**: Для базового взаимодействия с системой
2. **GraphQL API**: Для сложных запросов и оптимизации трафика
3. **WebSocket API**: Для реал-тайм функциональности
4. **LTI-совместимый интерфейс**: Для интеграции с LMS (Moodle, Canvas)

## Диаграммы и схемы

### Потоки данных в системе

```
       ┌─────────────┐           ┌─────────────┐
       │             │           │             │
┌──────►  PDF/DOCX   ├──────────►Индексирование├────┐
│      │  Процессор  │           │             │    │
│      └─────────────┘           └─────────────┘    │
│                                                   │
│      ┌─────────────┐           ┌─────────────┐    │
│      │             │           │             │    │
┌──────►   Модуль    ├──────────►  Обработка   ├────┤
│      │ вир.пациентов│           │             │    │
│      └─────────────┘           └─────────────┘    ▼
│                                                ┌──────────┐    ┌─────────────┐
│      ┌─────────────┐                           │          │    │             │
└──────►   Веб-API   │                           │ Векторная├───►  AI-Модель   │
       │             │                           │    БД    │    │             │
       └─────────────┘                           │          │    └─────────────┘
              ▲                                  └──────────┘            │
              │                                       ▲                  │
              │                                       │                  │
              │                                       │                  ▼
       ┌──────┴────────┐                              │          ┌─────────────┐
       │               │                              │          │             │
       │ Пользователь  │◄─────────────────────────────┴──────────┤   Ответ     │
       │               │                                         │             │
       └───────────────┘                                         └─────────────┘
```

### Процесс синхронизации edge/cloud

```
Edge-узел                                            Облачный сервер
┌─────────────────┐                                 ┌─────────────────┐
│                 │                                 │                 │
│  Локальная БД   │◄────────┐   ┌──────────────────►│   Центральная   │
│                 │         │   │                   │       БД        │
└─────────────────┘         │   │                   └─────────────────┘
        │                   │   │                           │
        ▼                   │   │                           ▼
┌─────────────────┐         │   │                   ┌─────────────────┐
│                 │         │   │                   │                 │
│ Менеджер синхр. │◄────────┼───┼───────────────────┤ Менеджер синхр. │
│                 │         │   │                   │                 │
└─────────────────┘         │   │                   └─────────────────┘
        │                   │   │                           │
        ▼                   │   │                           ▼
┌─────────────────┐         │   │                   ┌─────────────────┐
│                 │         │   │                   │                 │
│    Очередь      │─────────┘   └───────────────────┤     Очередь     │
│  синхронизации  │                                 │  синхронизации  │
└─────────────────┘                                 └─────────────────┘
```

## Техническая реализация ключевых функций

### 1. TREAD оптимизация

```python
class TREADOptimizer:
    def __init__(self, model, config):
        self.model = model
        self.config = config
        self.router = TokenRouter(config)
        
    def optimize_forward_pass(self, input_ids, attention_mask=None):
        # Оценка важности токенов
        token_importance = self.router.calculate_importance(input_ids)
        
        # Маршрутизация токенов по слоям модели
        routing_map = self.router.route_tokens(token_importance)
        
        # Оптимизированный проход по модели
        return self._optimized_inference(input_ids, routing_map, attention_mask)
        
    def _optimized_inference(self, input_ids, routing_map, attention_mask):
        # Реализация оптимизированного инференса с TREAD
        # ...
```

### 2. Виртуальный пациент

```python
class VirtualPatient:
    def __init__(self, case_id, difficulty=1):
        self.case_id = case_id
        self.difficulty = difficulty
        self.vital_signs = {}
        self.symptoms = []
        self.medical_history = {}
        self.examinations = {}
        self.revealed_info = {
            "vital_signs": False,
            "symptoms": False,
            "medical_history": False,
            "examinations": {},
        }
        
    def reveal_information(self, info_type, specific_item=None):
        """Открыть определенную информацию о пациенте студенту"""
        if info_type in ["vital_signs", "symptoms", "medical_history"]:
            self.revealed_info[info_type] = True
            return getattr(self, info_type)
        elif info_type == "examinations" and specific_item:
            self.revealed_info["examinations"][specific_item] = True
            return self.examinations.get(specific_item)
            
    def evaluate_diagnosis(self, student_diagnosis):
        """Оценить диагностическое решение студента"""
        # Реализация оценки диагноза
        # ...
```

### 3. Система геймификации

```python
class AchievementSystem:
    def __init__(self, user_id):
        self.user_id = user_id
        self.achievements = {}
        self.points = 0
        self.level = 1
        
    def add_achievement(self, achievement_id, points):
        """Добавить достижение пользователю"""
        if achievement_id not in self.achievements:
            self.achievements[achievement_id] = {
                "unlocked": True,
                "unlock_time": datetime.now(),
                "points": points
            }
            self.points += points
            self._check_level_up()
            
    def _check_level_up(self):
        """Проверить, достиг ли пользователь нового уровня"""
        # Реализация логики повышения уровня
        # ...
```

## Заключение

Техническая архитектура DocMentor обеспечивает оптимальное сочетание производительности, доступности и масштабируемости для эффективного решения задач медицинского образования. Инновационные технологии, такие как TREAD-оптимизация и гибридная edge/cloud архитектура, позволяют системе эффективно работать даже в условиях ограниченных вычислительных ресурсов и нестабильного интернет-соединения.

Модульный дизайн обеспечивает легкость расширения функциональности и адаптации к различным образовательным контекстам, а открытые API предоставляют возможности для интеграции с существующими системами управления обучением.
